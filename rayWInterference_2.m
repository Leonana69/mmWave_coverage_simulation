clear;
%%
Nt = 64; % tx antenna elements number
d_to_lambda = 1/4; % tx antenna distance
alpha = -3.1; % path loss parameter
beta = 5.75e-5; % path loss parameter
bandwidth = 800e6; % bandwidth of channel
M = 3; % parameter of Nakagami-M model
r = 30; % range of interference
R = 150; % range of interference

Pt = 631; % tx transmit power 28dBm
TxRxGain = 16; % 16 dB for tx rx antenna gain
sigma = 10; % noise figure

txHeight = 5;
rxHeight = 1.6;

%% read map
viewer = siteviewer("Buildings","grandCentralTerminal.osm","Basemap","openstreetmap");

%% define tx
clearMap(viewer);

% att
% txLats = [40.75420700, 40.75588800, 40.75853600, 40.75440000, 40.75536900, 40.75653300, 40.75483400, 40.75879400, 40.75913000, 40.75799100, 40.75802900, 40.75661000, 40.75451100, 40.75536000, 40.75859070, 40.75537400, 40.75447083, 40.75492500, 40.75892900, 40.75501100, 40.75584412, 40.75577800, 40.75584412, 40.75857900, 40.75486000, 40.75447083, 40.75106900, 40.75893200, 40.75859070, 40.75447083, 40.75447083, 40.75251700, 40.75178800, 40.75098100, 40.75447083, 40.75584412, 40.75172424, 40.75892300, 40.75185400, 40.75198400, 40.75401300, 40.75447100, 40.75172424, 40.75721741, 40.75035095, 40.75309753, 40.75284800, 40.75309753, 40.75447083, 40.75309753, 40.75806100, 40.75035095, 40.75200100, 40.75125000, 40.75035095, 40.74897766, 40.75447083, 40.75721741, 40.75721741, 40.75721741, 40.75309753, 40.75320500, 40.75035095, 40.74989600, 40.74884000, 40.75159800, 40.75117900, 40.75035095, 40.75312000, 40.75280200, 40.75309753, 40.75176400, 40.75309753, 40.75172424, 40.75859070, 40.75309753, 40.75895300, 40.75035100, 40.75286500, 40.75441400, 40.75035095, 40.75433800, 40.75172424, 40.75700700, 40.75216800, 40.75172424, 40.75283300, 40.75218200, 40.75035095, 40.75172424, 40.75099800, 40.75172424, 40.75372600, 40.75010500, 40.75729200, 40.75882200, 40.75859100, 40.75731400, 40.75447083, 40.75004000, 40.75654300, 40.75698700, 40.75896900, 40.75741300, 40.75015200, 40.75185800, 40.75837500, 40.75896600, 40.75903000, 40.75552900, 40.75095800, 40.75349500, 40.75172424, 40.75519800, 40.75574200, 40.75680200, 40.75447083, 40.75319300, 40.75512200, 40.75198900, 40.75726100, 40.75477900, 40.75496900, 40.75460100, 40.75603200, 40.75574500, 40.75900800, 40.75448700, 40.75722900, 40.75676700, 40.75468600, 40.75859070, 40.75305200, 40.75272400, 40.74998000, 40.75434600, 40.75721741, 40.75461700, 40.75547800, 40.75707300, 40.75685800, 40.75682500, 40.75892100, 40.75603900, 40.75874300, 40.75309753, 40.75172424, 40.74971700, 40.75172424, 40.75001300, 40.75400700, 40.75444900, 40.75115000, 40.74845600, 40.74914900, 40.74893200, 40.75859070, 40.75172424, 40.75035095, 40.75172424, 40.74871800, 40.75584412, 40.75118900, 40.75471400, 40.75634300, 40.75309753, 40.75103800, 40.75309753, 40.75853300, 40.75721741, 40.75447083, 40.74914500, 40.75772300, 40.75848700, 40.75689900, 40.75584400, 40.75542500, 40.74885300, 40.75591100, 40.75096200, 40.74982300, 40.75675100, 40.75814800, 40.74897766, 40.74969600, 40.75197800, 40.75544200, 40.75584412, 40.75817000, 40.75721700, 40.75234400, 40.74892800, 40.75172424, 40.75017900, 40.75035095, 40.75172424, 40.75414600, 40.75514800, 40.75077900, 40.75545700, 40.75825900, 40.75680200, 40.75496400, 40.75031800, 40.75360000, 40.75908400, 40.75692200, 40.75859070, 40.75754400, 40.75172400, 40.74959200, 40.75623100, 40.75309753, 40.75900300, 40.75787700, 40.75681500, 40.75364300, 40.74975000, 40.75804000, 40.75309753, 40.74984200, 40.74969100, 40.75733900, 40.74915200, 40.75502800, 40.75605800, 40.74987800, 40.75022300, 40.75747500, 40.75822100, 40.75314900, 40.74929400, 40.75201400, 40.75245000, 40.75211500, 40.75122500, 40.75686300, 40.74891000, 40.75626200, 40.75680700, 40.75543200, 40.75825900, 40.75825900, 40.75825900, 40.75667600, 40.75642000, 40.75593200, 40.75551600, 40.75551600, 40.75545100, 40.75566900, 40.75524500, 40.75524500, 40.75568000, 40.75569200, 40.75564200, 40.75564200, 40.75536700, 40.75536700, 40.75536700, 40.75536700, 40.75536700, 40.75536700, 40.75476800, 40.75466900, 40.75467300, 40.75467300, 40.75467300, 40.75574100, 40.75574100, 40.75629000, 40.75651600, 40.75820500, 40.75820500, 40.75820500, 40.75820500, 40.75133400, 40.75530200, 40.75776100, 40.75530200, 40.75017500, 40.74849700, 40.75631000, 40.75399600, 40.75767900, 40.75688200, 40.75688200, 40.75723700, 40.75804500, 40.75804500, 40.75675700, 40.75477100, 40.74936900, 40.75691000, 40.74837000, 40.75464200, 40.75464200, 40.75464200, 40.75389500, 40.75389500, 40.75261300, 40.75267000, 40.75267000, 40.75315500, 40.75375400, 40.75388700, 40.75388700, 40.75388700, 40.75332300, 40.75332300, 40.75332300, 40.75179700, 40.75356700, 40.75390600, 40.75459700, 40.75407000, 40.75838100, 40.75862900, 40.75237700, 40.75094600, 40.74943200, 40.75720200, 40.75720200, 40.75428400, 40.75038900, 40.74860800, 40.74883700, ];
% txLons = [-73.97326700, -73.97685500, -73.96996500, -73.97690000, -73.97446900, -73.97121300, -73.97531000, -73.97274800, -73.97246500, -73.97109100, -73.97614000, -73.97454300, -73.97523700, -73.97347300, -73.96751404, -73.97459200, -73.97575378, -73.97668400, -73.96967000, -73.97363100, -73.97575378, -73.97714900, -73.97712708, -73.97703300, -73.97738100, -73.97712708, -73.97113900, -73.96788000, -73.97712708, -73.97026062, -73.96888733, -73.96745700, -73.97077500, -73.96824900, -73.97438049, -73.96888733, -73.97300720, -73.97511500, -73.97102400, -73.97156300, -73.96888700, -73.96980300, -73.97026062, -73.96751404, -73.97575378, -73.97575378, -73.97438000, -73.97026062, -73.96888733, -73.97163391, -73.97718500, -73.97300720, -73.97665900, -73.97455900, -73.97163391, -73.97712708, -73.96888733, -73.96751404, -73.97026062, -73.97712708, -73.96751404, -73.97329700, -73.97300720, -73.97485700, -73.97300700, -73.97595700, -73.97630600, -73.97026062, -73.97495700, -73.97388200, -73.97300720, -73.97087700, -73.97026062, -73.97026062, -73.97575378, -73.97026062, -73.96982400, -73.97552500, -73.97470700, -73.97209200, -73.97575378, -73.97728400, -73.97438049, -73.97075300, -73.97524300, -73.97438049, -73.97389500, -73.97392300, -73.97163391, -73.97163391, -73.97193600, -73.96888733, -73.97185400, -73.97484800, -73.97053200, -73.97710200, -73.97630300, -73.97729400, -73.97575378, -73.97678000, -73.97468700, -73.97248600, -73.97714700, -73.97647900, -73.97621800, -73.97710700, -73.97427900, -73.97717300, -73.97480700, -73.97733900, -73.97601600, -73.97603500, -73.97712708, -73.96813200, -73.97298800, -73.97074000, -73.97163391, -73.96975600, -73.96924700, -73.96779600, -73.96749900, -73.97141200, -73.97586500, -73.97213200, -73.97105300, -73.97179900, -73.96805300, -73.96827400, -73.96957100, -73.96976100, -73.97387500, -73.97438049, -73.96965300, -73.97634100, -73.96900500, -73.96738900, -73.97026062, -73.97331200, -73.97287800, -73.96787000, -73.96964900, -73.97007700, -73.97263100, -73.96963600, -73.97560100, -73.97438049, -73.97575378, -73.97305700, -73.97712708, -73.97178900, -73.96949600, -73.96932000, -73.96947500, -73.97139100, -73.97263000, -73.97027000, -73.97575378, -73.97712708, -73.97300720, -73.97712708, -73.97236800, -73.97300720, -73.97627200, -73.97002900, -73.96779000, -73.97712708, -73.97369400, -73.97026062, -73.97667800, -73.97575378, -73.97575378, -73.97604500, -73.97586900, -73.96898000, -73.97506000, -73.97644000, -73.97461100, -73.97300700, -73.97472100, -73.97621000, -73.97522600, -73.97433300, -73.97336200, -73.97575378, -73.97126700, -73.97708900, -73.97612500, -73.97163391, -73.97120900, -73.97010800, -73.97326000, -73.97087700, -73.97575378, -73.97745000, -73.97712708, -73.97438049, -73.96918700, -73.96821000, -73.96857100, -73.96809800, -73.97744800, -73.97221000, -73.97606500, -73.97289900, -73.97234200, -73.96835800, -73.96986600, -73.96751404, -73.96915800, -73.97071800, -73.97355800, -73.97262100, -73.97438049, -73.97246800, -73.97146300, -73.97732500, -73.97534800, -73.97425800, -73.97708500, -73.97575378, -73.97307600, -73.96923100, -73.97544100, -73.96936300, -73.97570000, -73.97699000, -73.97304500, -73.97085100, -73.97095100, -73.97732500, -73.97049000, -73.96967300, -73.97673800, -73.97687400, -73.97713000, -73.97589900, -73.97249600, -73.96738500, -73.96973800, -73.97186500, -73.97287000, -73.97646300, -73.97646300, -73.97646300, -73.97487600, -73.97477000, -73.97496000, -73.97489200, -73.97489200, -73.97541000, -73.97507500, -73.97567000, -73.97567000, -73.97516600, -73.97515900, -73.97519700, -73.97519700, -73.97514300, -73.97514300, -73.97514300, -73.97514300, -73.97514300, -73.97514300, -73.97438000, -73.97396100, -73.97395300, -73.97395300, -73.97395300, -73.97623400, -73.97623400, -73.97666200, -73.97654700, -73.97608900, -73.97608900, -73.97608900, -73.97608900, -73.97609100, -73.96769000, -73.97104000, -73.96769000, -73.97704300, -73.97692900, -73.97263300, -73.97576200, -73.97520400, -73.97379300, -73.97379300, -73.97275900, -73.97722600, -73.97722600, -73.97226000, -73.97008500, -73.97472400, -73.97179000, -73.97680900, -73.97196200, -73.97196200, -73.97196200, -73.97211500, -73.97211500, -73.97693600, -73.97652400, -73.97652400, -73.97206900, -73.97220600, -73.97209900, -73.97209900, -73.97209900, -73.97673000, -73.97673000, -73.97673000, -73.97702800, -73.97572300, -73.96871200, -73.96874200, -73.96884200, -73.97535000, -73.97464800, -73.97042100, -73.97072600, -73.97740900, -73.97553300, -73.97553300, -73.97408300, -73.97689100, -73.96758300, -73.96732300, ];
% verizon
% txLats = [40.75859070, 40.74897766, 40.75035095, 40.75035095, 40.75309753, 40.75721741, 40.75447083, 40.75172424, 40.75172424, 40.75538600, 40.75309753, 40.75859070, 40.75584412, 40.75309753, 40.75859100, 40.75035095, 40.75721741, 40.75619400, 40.75309753, 40.75447083, 40.75584412, 40.75859070, 40.75447083, 40.75856600, 40.75865100, 40.75584412, 40.75584412, 40.75447083, 40.75721741, 40.75172424, 40.75859070, 40.75859070, 40.74989300, 40.75035100, 40.75172400, 40.74897766, 40.75457600, 40.75721741, 40.75584400, 40.75309753, 40.75447083, 40.75859070, 40.75309753, 40.75172424, 40.75721741, 40.75712600, 40.75666800, 40.75412800, 40.75859070, 40.75172424, 40.75584412, 40.75721741, 40.75035095, 40.74837000, 40.75859070, 40.74897800, 40.75035095, 40.75172424, 40.74897766, 40.75035095, 40.75584412, 40.75859070, 40.75859070, 40.75480300, 40.75721741, 40.75447083, 40.74897766, 40.75172424, 40.75309753, 40.75309753, 40.75584400, 40.75309753, 40.75721700, 40.75584412, 40.75309753, 40.75035095, 40.75721741, 40.75584412, 40.75309753, 40.75584412, 40.75447083, 40.75172424, 40.75035095, 40.75721741, 40.74897766, 40.75035095, 40.75035095, 40.74897766, 40.75859070, 40.75584412, 40.75309753, 40.75172424, 40.75584412, 40.74897766, 40.75427500, 40.75172424, 40.75859100, 40.75309753, 40.75584412, 40.75035095, 40.75172424, 40.75859100, 40.75859070, 40.75309753, 40.75584412, 40.75531600, 40.75447083, 40.75676000, 40.75447083, 40.75584412, 40.75309753, 40.75309753, 40.75721741, 40.74897800, 40.75035095, 40.74897766, 40.75046700, 40.75035095, 40.74897766, 40.75309753, 40.75309753, 40.75721741, 40.75035095, 40.75172424, 40.75309753, 40.75035095, 40.75584412, 40.75172424, 40.75309753, 40.75309753, 40.75172424, 40.75721700, 40.75584400, 40.75657700, 40.75172424, 40.75133200, 40.75584412, 40.75712200, 40.75721741, 40.75859070, 40.75447083, 40.75584412, 40.75172424, 40.75721741, 40.75584412, 40.74886000, 40.74897766, 40.75035095, 40.74953600, 40.74897766, 40.75035100, 40.74897766, 40.74897766, 40.75035095, 40.75584412, 40.75859070, 40.75447083, 40.75859100, 40.75172424, 40.75309753, 40.75721741, 40.75172424, 40.75309753, 40.75447083, 40.75309753, 40.75172424, 40.75721741, 40.75803300, 40.75859070, 40.75721741, 40.75721741, 40.75584412, 40.75584412, 40.75035095, 40.75721741, 40.75859070, 40.74897766, 40.75447083, 40.75192000, 40.75447083, 40.75447083, 40.75721741, 40.75309753, 40.75118700, 40.75584400, 40.75859070, 40.75290100, 40.75172400, 40.75584400, 40.75584400, 40.75193600, 40.75035095, 40.75035095, 40.75136700, 40.75584400, 40.75456300, 40.75451700, 40.75423700, 40.75859100, 40.75065500, 40.75447083, 40.75447083, 40.75309753, 40.75309753, 40.75859070, 40.75584400, 40.74897766, 40.75035095, 40.75859070, 40.75447083, 40.75584412, 40.75227100, 40.75847500, 40.75672300, 40.75721741, 40.75576800, 40.75850100, 40.75823100, 40.75584412, 40.75832100, 40.75584400, 40.75035095, 40.75492800, 40.75584400, 40.75172424, 40.75309800, 40.75325100, 40.75721741, 40.75205800, 40.75424500, 40.75054200, 40.74925200, 40.75085700, 40.74849100, 40.75447083, 40.75859070, 40.75721741, 40.75584412, 40.75430900, 40.75721741, 40.75721741, 40.75721741, 40.75584412, 40.75035095, 40.75721700, 40.75721741, 40.75721741, 40.75684200, 40.75172424, 40.75412800, 40.75035095, 40.75309800, 40.75458500, 40.75292000, 40.75398200, 40.75452400, 40.75502000, 40.75859070, 40.75172400, 40.75859100, 40.75721700, 40.75859070, 40.75721741, 40.75859070, 40.75309753, 40.75859070, 40.75041000, 40.75761000, 40.75172400, 40.75195300, 40.75807600, 40.75378400, 40.75605100, 40.75515700, 40.75447083, 40.75378400, 40.75466700, 40.75447083, 40.75092400, 40.75264000, 40.75448600, 40.74939300, 40.75859070, 40.75859070, 40.75721700, 40.75309753, 40.75859070, 40.75584412, 40.75584412, 40.75584412, 40.75032000, 40.75584412, 40.75859070, 40.75035100, 40.75584412, 40.75030600, 40.75332200, 40.75246400, 40.75301700, 40.75796100, 40.75859070, 40.75528200, 40.75172424, 40.75594500, 40.75111000, 40.75091500, 40.74852000, 40.74897800, 40.75721741, 40.75172424, 40.75447083, 40.75721741, 40.75447083, 40.75187700, 40.75630200, 40.75721741, 40.75721700, 40.75447083, 40.75447083, 40.75575800, 40.75290100, 40.75309800, 40.75447083, 40.75086000, 40.74897766, 40.75035100, 40.75452200, 40.75172424, 40.75035095, 40.75255500, 40.75505900, 40.75893400, 40.75172424, 40.74987400, 40.75447100, 40.75192000, 40.74897766, 40.75035095, 40.74932100, 40.75721741, 40.75317400, 40.74952700, 40.75461800, 40.75859100, 40.75035095, 40.75309800, 40.75062200, 40.75447083, 40.75721741, 40.75466700, 40.75309753, 40.75785300, 40.75556900, 40.75859070, 40.75447100, 40.75721741, 40.75859070, 40.75721741, 40.75309800, 40.75653100, 40.75447100, 40.75355500, 40.75584412, 40.75859070, 40.75756400, 40.75859070, 40.75719800, 40.75349000, 40.75859070, 40.75281300, 40.75666800, 40.75270500, 40.75172424, 40.75309753, 40.75412800, 40.75447083, 40.75412800, 40.75584400, 40.75447100, 40.75584400, 40.75697500, 40.75035095, 40.75139100, 40.75035095, 40.75309753, 40.75859070, 40.74989300, 40.75767500, 40.74897766, 40.75859070, 40.75813300, 40.75099400, 40.75859070, 40.75859070, 40.75012200, 40.75447083, 40.75035095, 40.75194600, 40.75721741, 40.74897766, 40.75825200, 40.75447083, 40.75035095, 40.75355500, 40.75172424, 40.75172424, 40.75035095, 40.75721741, 40.75859070, 40.75273500, 40.75256300, 40.75261900, 40.75797700, 40.75184600, 40.74884000, 40.75195200, 40.75127800, 40.75196800, 40.75191200, 40.75186600, 40.75237700, 40.75197200, 40.75051500, 40.75053000, 40.75156000, 40.75709200, 40.75740800, 40.75910900, 40.75889200, ];
% txLons = [-73.97163391, -73.97712708, -73.97712708, -73.97575378, -73.97438049, -73.97300720, -73.97438049, -73.97300720, -73.97575378, -73.97621200, -73.97712708, -73.97712708, -73.97163391, -73.96888733, -73.97478400, -73.97575378, -73.97026062, -73.97679000, -73.97300720, -73.96888733, -73.96888733, -73.97438049, -73.97163391, -73.97300700, -73.97724000, -73.97712708, -73.97300720, -73.97575378, -73.96751404, -73.97712708, -73.97163391, -73.97026062, -73.97712700, -73.97747000, -73.97729900, -73.97300720, -73.97607100, -73.96751404, -73.97593700, -73.97300720, -73.97712708, -73.97575378, -73.96888733, -73.97438049, -73.97575378, -73.97676100, -73.97346500, -73.97747000, -73.97712708, -73.97575378, -73.97712708, -73.97575378, -73.96888733, -73.97673400, -73.97163391, -73.97729900, -73.97438049, -73.97575378, -73.97438049, -73.97575378, -73.97575378, -73.96888733, -73.96751404, -73.97356700, -73.96888733, -73.97163391, -73.97026062, -73.97575378, -73.97438049, -73.97026062, -73.97435500, -73.97712708, -73.97579500, -73.97438049, -73.97300720, -73.97438049, -73.97300720, -73.97712708, -73.97300720, -73.97300720, -73.97026062, -73.97026062, -73.97712708, -73.97163391, -73.97438049, -73.97438049, -73.97712708, -73.97438049, -73.96888733, -73.97575378, -73.96888733, -73.97575378, -73.97026062, -73.96751404, -73.97634200, -73.96751404, -73.97630300, -73.97575378, -73.97712708, -73.96751404, -73.97575378, -73.97094700, -73.97575378, -73.97300720, -73.96751404, -73.97469700, -73.97712708, -73.97300700, -73.97300720, -73.97712708, -73.97026062, -73.97300720, -73.97026062, -73.97706700, -73.97575378, -73.97575378, -73.97597900, -73.97575378, -73.97575378, -73.97026062, -73.97438049, -73.96751404, -73.97163391, -73.97712708, -73.97026062, -73.96888733, -73.97438049, -73.96751404, -73.97163391, -73.96888733, -73.97438049, -73.97704100, -73.97429500, -73.97663900, -73.97438049, -73.97438000, -73.97026062, -73.97431000, -73.97300720, -73.97712708, -73.97438049, -73.96888733, -73.97575378, -73.96888733, -73.97163391, -73.97716600, -73.97712708, -73.97712708, -73.97672000, -73.97712708, -73.97644000, -73.97575378, -73.97712708, -73.97575378, -73.97712708, -73.97026062, -73.97712708, -73.97590600, -73.97712708, -73.97575378, -73.97026062, -73.97575378, -73.97300720, -73.97026062, -73.97300720, -73.97575378, -73.97438049, -73.97318500, -73.97300720, -73.97438049, -73.97438049, -73.97438049, -73.97300720, -73.97163391, -73.96888733, -73.97163391, -73.97438049, -73.96888733, -73.97340000, -73.96888733, -73.97163391, -73.96751404, -73.97300720, -73.97027300, -73.97015500, -73.97163391, -73.97496900, -73.97266400, -73.96755600, -73.97052200, -73.96751400, -73.96888733, -73.96888733, -73.97343900, -73.97099000, -73.96969900, -73.96971100, -73.96891700, -73.96806300, -73.97570000, -73.97163391, -73.97300720, -73.97438049, -73.97163391, -73.97026062, -73.97441700, -73.97163391, -73.97438049, -73.97300720, -73.97438049, -73.97712708, -73.96968300, -73.96904700, -73.96789600, -73.96751404, -73.97163400, -73.96930000, -73.97093700, -73.97026062, -73.97059800, -73.96768600, -73.96888733, -73.96867500, -73.96984900, -73.97575378, -73.97123000, -73.97471800, -73.97026062, -73.97350500, -73.96862700, -73.97595500, -73.97438000, -73.97548100, -73.97507500, -73.97438049, -73.97026062, -73.97163391, -73.97712708, -73.97438000, -73.97300720, -73.97163391, -73.97163391, -73.97300720, -73.97575378, -73.97208100, -73.97026062, -73.97026062, -73.97014700, -73.96751404, -73.96888700, -73.97438049, -73.97536100, -73.97026100, -73.97299500, -73.96875500, -73.97438000, -73.97314500, -73.97163391, -73.97392300, -73.97273300, -73.97129100, -73.97575378, -73.97300720, -73.97163391, -73.97575378, -73.97712708, -73.97174000, -73.97071800, -73.97533700, -73.97552500, -73.97197700, -73.97438000, -73.97287800, -73.96888700, -73.96888733, -73.97129100, -73.96967200, -73.97026062, -73.97435600, -73.97483800, -73.96982400, -73.97563300, -73.97712708, -73.97712708, -73.97079500, -73.97300720, -73.97712708, -73.97712708, -73.97026062, -73.97712708, -73.97556700, -73.97026062, -73.97026062, -73.97292400, -73.97712708, -73.97152200, -73.96952400, -73.97300700, -73.97389600, -73.97163400, -73.96888733, -73.97122400, -73.97575378, -73.97019400, -73.97398800, -73.97372500, -73.97392300, -73.97472400, -73.97163391, -73.97438049, -73.97438049, -73.97438049, -73.97712708, -73.97178600, -73.97266400, -73.96751404, -73.96731800, -73.96751404, -73.96888733, -73.96931600, -73.97292800, -73.97143800, -73.97026062, -73.97651700, -73.97575378, -73.97586200, -73.97163400, -73.97575378, -73.97300720, -73.96995100, -73.97693100, -73.97438000, -73.97575378, -73.97714100, -73.97632600, -73.97549200, -73.97026062, -73.97163391, -73.97335100, -73.97163391, -73.97300700, -73.97575400, -73.96954900, -73.96774300, -73.97026062, -73.97747000, -73.97535900, -73.97712708, -73.97712708, -73.96859300, -73.96751404, -73.97018800, -73.97328200, -73.97438049, -73.97685200, -73.97026062, -73.97300720, -73.97300720, -73.97685200, -73.97163400, -73.97747000, -73.97575400, -73.97026062, -73.96888733, -73.96894200, -73.97026062, -73.96825200, -73.96869100, -73.97026062, -73.96751400, -73.96971100, -73.96751400, -73.97575378, -73.96751404, -73.96991700, -73.97438049, -73.97729900, -73.97285500, -73.97729900, -73.97584500, -73.97187600, -73.97438049, -73.97608000, -73.97575378, -73.97575378, -73.97163391, -73.97575400, -73.96980300, -73.97712708, -73.97163391, -73.97117600, -73.97666900, -73.96888733, -73.97438049, -73.97163400, -73.97163391, -73.97438049, -73.97437700, -73.97438049, -73.97163391, -73.96944400, -73.97163391, -73.97438049, -73.97438000, -73.97575378, -73.97438049, -73.97026062, -73.97163391, -73.97163391, -73.97412100, -73.97408600, -73.97462100, -73.96888400, -73.96955900, -73.97569300, -73.96878300, -73.97011800, -73.96961700, -73.96906100, -73.96957400, -73.96979000, -73.96914600, -73.97641800, -73.97583800, -73.96944400, -73.97199200, -73.97154200, -73.97664600, -73.97682200, ];
% t-mobile LTE sites location
txLats = [40.74846800, 40.74860200, 40.75003600, 40.75817300, 40.75117500, 40.75035100, 40.74979700, 40.74922000, 40.75126600, 40.75035095, 40.74966400, 40.75451200, 40.75323300, 40.75635300, 40.75499400, 40.75577000, 40.75859070, 40.75161000, 40.75172400, 40.75515700, 40.75721741, 40.75172424, 40.75309800, 40.75206800, 40.75309753, 40.75172424, 40.75466000, 40.75189200, 40.75447100, 40.75790400, 40.75035100, 40.75859070, 40.74897766, 40.74897766, 40.75416600, 40.75474500, 40.75447100, 40.75270500, 40.75337200, 40.75584412, 40.75309753, 40.75676000, 40.75859070, 40.75721741, 40.75584412, 40.75154500, 40.75035100, 40.75859100, 40.74966400, 40.75669700, 40.75218200, 40.75837900, 40.75859070, 40.75031100, 40.75584412, 40.75625600, 40.75035095, 40.75007600, 40.75309753, 40.75309753, 40.75344100, 40.74849300, 40.75216600, 40.75172424, 40.75051300, 40.75145000, 40.75035095, 40.75712600, 40.75816800, 40.75035100, 40.75447100, 40.75333000, 40.75873800, 40.75309753, 40.74913300, 40.74846300, 40.74838900, 40.75218200, 40.75412800, 40.75721741, 40.75721741, 40.75309800, 40.75282600, 40.75853600, 40.75721741, 40.75721741, 40.75441600, 40.75721700, 40.75206800, 40.75005700, 40.75332600, 40.75309800, 40.74897766, 40.75584412, 40.75584412, 40.75721741, 40.75309753, 40.75859070, 40.75035095, 40.75309753, 40.75721741, 40.75859070, 40.75447083, 40.75447083, 40.75584412, 40.74971000, 40.74897766, 40.75309753, 40.75346400, 40.75721741, 40.74905500, 40.74926000, 40.74854800, 40.75172424, 40.75721741, 40.75721741, 40.75309753, 40.75172424, 40.75309753, 40.74897766, 40.75035100, 40.75172424, 40.75721741, 40.75035095, 40.75720900, 40.75697000, 40.75859100, 40.75713800, 40.75581700, 40.75615500, 40.75721741, 40.75390400, 40.75447083, 40.75850300, 40.75351000, 40.75883000, 40.75507000, 40.75348600, 40.75915200, 40.75907900, 40.75515600, 40.75711200, 40.75238500, 40.75578000, 40.75720000, 40.75259000, 40.75172424, 40.75601900, 40.75683400, 40.75854100, 40.75309800, 40.75447083, 40.75470000, 40.75177700, 40.75584412, 40.75172400, 40.75035095, 40.75035095, 40.75359900, 40.75172424, 40.74897766, 40.75790400, 40.75515700, 40.75057100, 40.75584412, 40.75232800, 40.75026200, 40.75172424, 40.75309753, 40.75054700, 40.75584412, 40.75721741, 40.75087900, 40.75533500, 40.75035100, 40.75172424, 40.75103800, 40.75859070, 40.74860300, 40.75309753, 40.75477500, 40.75582100, 40.75035100, 40.75450300, 40.75483700, 40.75567200, 40.75392200, 40.75488300, 40.75344100, 40.75299900, 40.74943500, 40.74897766, 40.75575300, 40.75172424, 40.75035095, 40.75584412, 40.75309800, 40.75720300, 40.75800300, 40.75869400, 40.75452100, 40.74897766, 40.75567000, 40.75447083, 40.74943500, 40.75304800, 40.75447083, 40.75884000, 40.74897766, 40.75641900, 40.75859070, 40.75138100, 40.75859070, 40.75172424, 40.75290700, 40.75309753, 40.75035095, 40.75603000, 40.75247800, 40.75721741, 40.75309753, 40.75584412, 40.75035100, 40.75117500, 40.75860600, 40.75756400, 40.75172424, 40.75309800, 40.75369800, 40.75836200, 40.75790400, 40.74858500, 40.75172424, 40.75035100, 40.75082000, 40.74951000, 40.75447083, 40.75189200, 40.75209000, 40.75721741, 40.75309753, 40.75314000, 40.75035095, 40.75035095, 40.74884000, 40.75309800, 40.75805700, 40.74976600, 40.75447100, 40.75309800, 40.75584412, 40.75172424, 40.75549200, 40.75397600, 40.75649400, 40.75006000, 40.75155900, 40.75241100, 40.75309753, 40.75241100, 40.75300500, 40.75120500, 40.74982800, 40.74870900, 40.75049900, 40.75233500, 40.75292600, 40.75007500, 40.75081700, 40.75478100, 40.75059300, 40.74993800, 40.75316100, 40.75721741, 40.75033800, 40.75080500, 40.75488300, 40.75224100, 40.75713800, 40.75584800, 40.75048400, 40.75049400, 40.75735600, 40.74835600, 40.75721700, 40.75501900, 40.75476500, 40.75155100, 40.75126600, 40.75187700, 40.75463000, 40.75586500, 40.75309753, 40.75202700, 40.75115200, 40.75809100, 40.75439800, 40.75035095, 40.74897800, 40.74897766, 40.75457100, 40.75595800, 40.75551200, 40.75629900, 40.75112200, 40.75309753, 40.74943500, 40.75510600, 40.75600900, 40.75144100, 40.75859070, 40.75721900, 40.75859070, 40.75172424, 40.75344500, 40.75517400, 40.75721741, 40.75069600, 40.75746900, 40.75558300, 40.75165700, 40.75283400, 40.75709200, 40.75505300, 40.75542000, 40.75182700, 40.75182300, 40.75522500, 40.75840000, 40.75206700, 40.75327700, 40.75467600, 40.75283800, 40.75280400, 40.75220500, 40.75007500, 40.74939800, 40.75492500, 40.74830800, 40.75004000, 40.74931000, 40.75654600, 40.75194700, 40.75894100, 40.75128600, 40.75213100, 40.75200700, 40.75206400, 40.75036600, 40.75918800, 40.75447400, 40.75312600, 40.75543400, 40.75681600, 40.75776600, 40.75680700, 40.75578700, 40.75852300, 40.75608200, 40.75565900, 40.75453200, 40.75297900, 40.75133700, 40.75737000, 40.75134800, 40.75035800, 40.74910100, 40.75891900, 40.75216300, 40.75703300, 40.75413800, 40.75309900, 40.75330400, 40.75304700, 40.75859900, 40.75623900, 40.75853000, 40.75412400, 40.75703300, 40.75918000, 40.75639200, 40.75850100, 40.75818800, 40.75338700, 40.75211300, 40.75163700, 40.75333700, 40.75903300, 40.75040400, 40.74875300, 40.75451500, 40.75249400, 40.74838200, 40.75178300, 40.75682100, 40.75557700, 40.75568900, 40.74838600, 40.75485500, 40.75215600, 40.74976400, 40.74887100, 40.75366400, 40.75520900, 40.75589600, 40.75869200, 40.75367100, 40.75270800, 40.75298100, 40.75516800, 40.75230700, 40.75375600, 40.75401100, 40.75364600, 40.75094400, 40.75011500, 40.75679300, 40.75786600, 40.75743400, 40.75321600, 40.75325400, 40.75754900, 40.75493300, 40.75404600, 40.75291400, 40.75684800, 40.75917100, 40.75679200, 40.75697000, 40.75540500, 40.75233500, 40.75508200, 40.75023700, 40.75518400, 40.75138700, 40.75365800, 40.75582500, 40.75219800, 40.75891200, 40.75269000, 40.75775200, 40.75328900, 40.75253900, 40.75288000, 40.75402300, 40.75378800, 40.75277300, 40.75264000, 40.75264000, 40.75192900, 40.75336800, 40.75264000, 40.75117900, 40.75487700, 40.75270700, 40.75338400, 40.74883400, 40.75454300, 40.75632700, 40.75776700, 40.75720000, 40.75813100, 40.75621700, 40.75747700, 40.75324200, 40.75714900, 40.75071000, 40.75071000, 40.75071000, 40.75071000, 40.75071000, 40.75490600, 40.75219800, 40.75333400, 40.74858700, 40.74983000, 40.75268300, 40.75135000, 40.75299500, 40.74952700, 40.75400200, 40.75000000, 40.75338700, 40.74979200, 40.75184600, 40.75603600, 40.74935500, 40.75344500, 40.75190800, 40.75177400, 40.75339500, 40.75860200, 40.75757200, 40.74871100, 40.75186400, 40.75636500, 40.75904500, 40.75583300, 40.75583300, 40.74908300, 40.75311300, 40.75076500, 40.75214900, 40.74861900, 40.75735500, 40.75850700, 40.75527200, 40.75519600, 40.75374500, 40.75054200, 40.75697600, 40.75694800, 40.75726600, 40.75721600, 40.75575000, 40.75469800, 40.75375800, 40.75885600, 40.75798400, 40.75757700, 40.75563200, 40.75771800, 40.75899200, 40.75391000, 40.75455700, 40.75769000, 40.75546700, 40.75505100, 40.75484700, 40.75628700, 40.75341800, 40.75441500, 40.75566100, 40.75518400, 40.75669100, 40.75808700, 40.75902400, 40.75571400, 40.75844600, 40.75756100, 40.75893000, 40.75261900, 40.75775700, 40.75828200, 40.75794500, 40.75482300, 40.75417700, 40.75840700, 40.75698800, 40.75675000, 40.75101000, 40.75627800, 40.75802500, 40.75761800, 40.75594500, 40.75309400, 40.75272100, 40.75701200, 40.75131600, 40.75121200, 40.75494200, 40.75182600, 40.75231100, 40.75076500, 40.75781100, 40.75680900, 40.75075800, 40.75637700, 40.75122100, 40.75088900, 40.75063100, 40.75733500, 40.75293800, 40.75164200, 40.75559200, 40.75559000, 40.75447500, 40.75460400, 40.75305100, 40.75430500, 40.75107200, 40.75011600, 40.75228900, 40.75374400, 40.75162100, 40.75193400, 40.74893100, 40.75731300, 40.75731300, 40.74892600, 40.74830700, 40.74928400, 40.75066100, 40.75173800, 40.74968700, 40.75163900, 40.75053100, 40.75068800, 40.75102600, 40.75589800, 40.75589800, 40.74920100, 40.75548800, 40.75510600, 40.75317100, 40.75127500, 40.74840900, 40.75366000, 40.74975400, 40.75065200, 40.75564400, 40.75324300, 40.75474900, 40.75618400, 40.75878100, 40.75196100, 40.75614200, 40.75539000, 40.75304300, 40.75303800, 40.75614600, 40.75298000, 40.75682000, 40.75356700, 40.75255300, 40.75187100, 40.75392400, 40.75417600, 40.75596600, 40.75225400, 40.75212000, 40.74889200, 40.75127400, 40.75480300, 40.75768300, 40.75210800, 40.75730000, 40.75667400, 40.75704300, 40.75006700, 40.75131100, 40.75807800, 40.75725900, 40.75425000, 40.74935500, 40.75067200, 40.75624100, 40.75294800, 40.75172400, 40.75173500, 40.75371600, 40.75563400, 40.74973900, 40.75097400, 40.75197600, 40.75230300, 40.75043900, 40.75089300, 40.75458800, 40.75422700, 40.75810700, 40.75483600, 40.75251800, 40.75541800, 40.75550500, 40.75478700, 40.75890000, 40.75325800, 40.75826600, 40.74852800, 40.74848600, 40.74886700, 40.75282600, 40.75383400, 40.75423500, 40.75196000, 40.75148700, 40.75141000, 40.75101000, 40.75773400, 40.75223200, 40.75269900, 40.75675600, 40.75675600, 40.75669900, 40.75667200, 40.75669100, 40.75669500, 40.75657800, 40.75844600, 40.75114100, 40.75021000, 40.75271400, 40.75162500, 40.75175900, 40.75335300, 40.75112900, 40.74903900, 40.74903900, 40.75159300, 40.75494800, 40.75484800, 40.75484800, 40.75317000, 40.75484800, 40.75484800, 40.75762900, 40.75182100, 40.75092300, 40.75107300, 40.74963500, 40.75235600, 40.75396700, 40.74953500, 40.74953500, 40.75123300, 40.75216700, 40.74892300, 40.74848000, 40.74872200, 40.75270300, 40.75687000, 40.75664500, 40.75263600, 40.75263600, 40.75094200, 40.74987400, 40.74966800, 40.74963800, 40.74943500, 40.75196100, 40.75113100, 40.75162300, 40.75127000, 40.75149200, 40.74988600, 40.74969500, 40.74866500, 40.75436800, 40.74985500, 40.74955400, 40.74894000, 40.75173200, 40.75721741, 40.75172424, 40.75584412, 40.75447083, 40.75859070, 40.75172424, 40.75172424, 40.75236900, ];
txLons = [-73.97464800, -73.97350700, -73.97178400, -73.97037100, -73.97383100, -73.97644000, -73.97152700, -73.96992100, -73.97666900, -73.97712708, -73.96751400, -73.97645300, -73.97284900, -73.97470600, -73.97685900, -73.97058700, -73.97575378, -73.97712700, -73.96980300, -73.97712700, -73.97575378, -73.97438049, -73.97529600, -73.97026100, -73.97300720, -73.97712708, -73.97711200, -73.97576200, -73.97313600, -73.97513000, -73.97346500, -73.97712708, -73.96751404, -73.97438049, -73.97239700, -73.97602800, -73.97232100, -73.97575400, -73.97438000, -73.97300720, -73.97575378, -73.97186300, -73.96751404, -73.97438049, -73.97712708, -73.97351300, -73.97399900, -73.97041300, -73.97575400, -73.97438000, -73.97300700, -73.96878200, -73.97438049, -73.97397700, -73.96751404, -73.96751400, -73.97575378, -73.97273300, -73.97300720, -73.97438049, -73.97026100, -73.97206500, -73.97395300, -73.97712708, -73.97462300, -73.97685200, -73.97163391, -73.97328200, -73.97004900, -73.97321500, -73.96896800, -73.97444100, -73.97472400, -73.97438049, -73.97708500, -73.97335100, -73.97438000, -73.97026100, -73.97438000, -73.97575378, -73.97575378, -73.97149700, -73.97495700, -73.97569900, -73.96888733, -73.96751404, -73.97357900, -73.96861300, -73.96751400, -73.96761200, -73.96865800, -73.96785700, -73.96751404, -73.96888733, -73.97712708, -73.97712708, -73.97712708, -73.97026062, -73.96751404, -73.97712708, -73.97163391, -73.96751404, -73.96888733, -73.96888733, -73.97026062, -73.97300700, -73.97712708, -73.97438049, -73.97586600, -73.96888733, -73.97149100, -73.97662700, -73.97408400, -73.97575378, -73.97026062, -73.96751404, -73.96751404, -73.97300720, -73.97026062, -73.97300720, -73.97614600, -73.97575378, -73.96888733, -73.96888733, -73.96899300, -73.97035400, -73.97148100, -73.97164100, -73.96985700, -73.97459300, -73.97575378, -73.97367000, -73.97712708, -73.96898800, -73.97217000, -73.96760800, -73.97361200, -73.97218700, -73.97466400, -73.97004700, -73.97714400, -73.97176600, -73.97338200, -73.97687500, -73.96984800, -73.97691500, -73.97575378, -73.97022200, -73.97112900, -73.97477100, -73.96998600, -73.96888733, -73.96820100, -73.97438000, -73.96751404, -73.97057800, -73.97163391, -73.97575378, -73.97026100, -73.97575378, -73.97163391, -73.97087100, -73.96888700, -73.96883200, -73.96751404, -73.96844800, -73.97619700, -73.97163391, -73.96751404, -73.97431500, -73.96751404, -73.96751404, -73.97438000, -73.97010800, -73.97400600, -73.97438049, -73.97644000, -73.97438049, -73.97188400, -73.96751404, -73.97528200, -73.97693300, -73.97379200, -73.97275200, -73.96957400, -73.96751400, -73.97014300, -73.96998600, -73.96785700, -73.97173200, -73.97529600, -73.97026062, -73.96751400, -73.97026062, -73.97163391, -73.96751404, -73.96994400, -73.96924100, -73.96772700, -73.97253100, -73.97371300, -73.97712708, -73.97164400, -73.97575378, -73.97163400, -73.97274000, -73.97163391, -73.97438000, -73.96751404, -73.97415500, -73.97712708, -73.97026100, -73.97026062, -73.97300720, -73.97435500, -73.97438049, -73.97438049, -73.97309900, -73.97261300, -73.96751404, -73.97026062, -73.97438049, -73.97410600, -73.97438000, -73.96842200, -73.96918200, -73.97300720, -73.97026100, -73.97618300, -73.96865800, -73.97300700, -73.96918200, -73.97026062, -73.97232100, -73.97628600, -73.97565800, -73.97712708, -73.97557600, -73.97721900, -73.97575378, -73.97300720, -73.97504700, -73.97712708, -73.97712708, -73.97410600, -73.97232100, -73.96756300, -73.97442900, -73.97460900, -73.97609700, -73.97712708, -73.97575378, -73.96837300, -73.96968200, -73.96804700, -73.96912200, -73.97613800, -73.97438000, -73.97438049, -73.97438000, -73.97007000, -73.97122700, -73.97315400, -73.96918700, -73.97450800, -73.97096900, -73.97250400, -73.97354600, -73.97673700, -73.96878300, -73.97430900, -73.97480100, -73.97456900, -73.97575378, -73.97272600, -73.97096300, -73.97747000, -73.97494300, -73.97450600, -73.97596900, -73.97416500, -73.96766900, -73.96738000, -73.96733100, -73.97529600, -73.97385900, -73.97509800, -73.97579600, -73.97529600, -73.97605900, -73.97582000, -73.97742900, -73.97575378, -73.97340700, -73.97565700, -73.97741700, -73.97064500, -73.97300720, -73.97644000, -73.97575378, -73.96877900, -73.97721300, -73.97724600, -73.97441700, -73.97474600, -73.97026062, -73.97575400, -73.97722400, -73.97545100, -73.97431900, -73.97712708, -73.97094700, -73.97300720, -73.96888733, -73.97600400, -73.97651500, -73.96751404, -73.97415900, -73.96890300, -73.97462100, -73.97043700, -73.97740200, -73.97295400, -73.97025000, -73.96783200, -73.97166400, -73.97169500, -73.97191600, -73.96943700, -73.97317400, -73.97692800, -73.97202900, -73.97734100, -73.97736400, -73.97070500, -73.97438800, -73.96796600, -73.97588300, -73.96780800, -73.97569000, -73.97018400, -73.97018400, -73.97513700, -73.97021200, -73.97647100, -73.97704700, -73.97651700, -73.97646300, -73.97032900, -73.97218000, -73.97523900, -73.97683800, -73.97474800, -73.97626300, -73.97518300, -73.97700500, -73.97696400, -73.97139700, -73.97539800, -73.97653200, -73.97511400, -73.97455500, -73.97721500, -73.97702300, -73.97557100, -73.97197600, -73.97109700, -73.96783600, -73.97669500, -73.97167600, -73.97683500, -73.97587900, -73.97662400, -73.97057900, -73.96736200, -73.97398500, -73.96935000, -73.97747500, -73.97186400, -73.97034400, -73.97146000, -73.96976700, -73.97006000, -73.97658500, -73.97528500, -73.97406400, -73.97511000, -73.97711500, -73.96912800, -73.97329800, -73.97650200, -73.97266300, -73.97256600, -73.97434700, -73.97284000, -73.97361400, -73.97324800, -73.97459800, -73.97163900, -73.96970800, -73.97572200, -73.97547600, -73.97205700, -73.97304600, -73.96990600, -73.96910500, -73.97487800, -73.97707800, -73.97388400, -73.97677700, -73.97395300, -73.97279700, -73.97233400, -73.97404300, -73.97439700, -73.97636200, -73.97655500, -73.97050400, -73.97594300, -73.97469800, -73.97492600, -73.96955100, -73.97422800, -73.97496000, -73.97734100, -73.96993500, -73.97267500, -73.97402200, -73.97436700, -73.97160600, -73.97660700, -73.97557800, -73.97560100, -73.97053200, -73.97426800, -73.97112600, -73.97151900, -73.97351100, -73.97721300, -73.97299700, -73.97179700, -73.97403700, -73.97715800, -73.97490700, -73.97647500, -73.97425800, -73.97499800, -73.97431200, -73.97431200, -73.97067100, -73.97224400, -73.97301500, -73.97286400, -73.97108500, -73.97738100, -73.97697400, -73.97272800, -73.97613500, -73.97498700, -73.97173300, -73.96976200, -73.97446300, -73.97633500, -73.96916400, -73.97695900, -73.97203800, -73.97160300, -73.97160300, -73.97160300, -73.97160300, -73.97160300, -73.97566000, -73.97580000, -73.97707400, -73.96827100, -73.97195200, -73.97713500, -73.97292400, -73.97638700, -73.97394800, -73.97551000, -73.97729900, -73.97676100, -73.97531500, -73.97728700, -73.96767900, -73.97284700, -73.97691300, -73.97633200, -73.97430700, -73.97707400, -73.97661800, -73.96766700, -73.97717300, -73.97650700, -73.97423800, -73.97634900, -73.97251100, -73.97063000, -73.97632600, -73.97361800, -73.97729100, -73.97458800, -73.97081800, -73.96895600, -73.97557100, -73.96959700, -73.96855200, -73.97390200, -73.97180400, -73.96987600, -73.97141800, -73.96951300, -73.97210300, -73.97296600, -73.97409100, -73.97485000, -73.97321500, -73.97492700, -73.97727500, -73.97743200, -73.97452800, -73.97545300, -73.97473200, -73.97409200, -73.96751800, -73.97748000, -73.97611300, -73.97731800, -73.97366600, -73.97277700, -73.97296200, -73.96961200, -73.97076000, -73.96922300, -73.96881000, -73.96878300, -73.97059900, -73.96860200, -73.96796500, -73.96945600, -73.97303400, -73.97505600, -73.97535500, -73.97497100, -73.97510500, -73.97542300, -73.97428000, -73.97399100, -73.96862400, -73.97324500, -73.97207300, -73.96744600, -73.96742300, -73.97555300, -73.97435500, -73.97414400, -73.96865600, -73.97165300, -73.97540500, -73.97437000, -73.97559000, -73.97584800, -73.97689200, -73.97064200, -73.97702000, -73.97008900, -73.96807000, -73.97131300, -73.97401000, -73.97619100, -73.97335100, -73.97503400, -73.97714500, -73.97523500, -73.97465800, -73.97551000, -73.97569500, -73.97089200, -73.97649100, -73.96965000, -73.97125900, -73.97379800, -73.96930800, -73.97224300, -73.97318200, -73.96825000, -73.97338100, -73.97338100, -73.97522000, -73.97531100, -73.97009600, -73.96882500, -73.97481800, -73.97557100, -73.97182100, -73.97574000, -73.97576900, -73.97563800, -73.97467000, -73.97467000, -73.97670900, -73.97021000, -73.96871600, -73.96980500, -73.97457200, -73.97741500, -73.96870200, -73.97377200, -73.97280900, -73.97221800, -73.97381400, -73.97489000, -73.97580000, -73.96730300, -73.97069500, -73.96769000, -73.96815500, -73.96874500, -73.96901800, -73.97142000, -73.97435400, -73.97455400, -73.97193900, -73.97294800, -73.97151700, -73.97297300, -73.97207300, -73.97687100, -73.97502600, -73.97528900, -73.97543100, -73.97296900, -73.97137500, -73.97102400, -73.96746300, -73.96771200, -73.96798000, -73.96877000, -73.97469000, -73.96948600, -73.97687000, -73.97467600, -73.97162000, -73.96749900, -73.97149600, -73.97143700, -73.97730800, -73.97602800, -73.97417900, -73.97413900, -73.97087200, -73.97304200, -73.97050000, -73.97571600, -73.96940200, -73.97488800, -73.97419000, -73.96871300, -73.96952500, -73.96883000, -73.97045000, -73.97460100, -73.96872000, -73.96823100, -73.96886400, -73.96975700, -73.97448700, -73.97255700, -73.97512800, -73.97194600, -73.97074300, -73.97299500, -73.97422800, -73.96844000, -73.97232600, -73.97645800, -73.97644000, -73.97173600, -73.96826200, -73.96783400, -73.97459400, -73.96913900, -73.96913900, -73.96941400, -73.96943700, -73.96942100, -73.96943700, -73.97237100, -73.97702800, -73.97736700, -73.97619600, -73.97517900, -73.97552500, -73.97519700, -73.97435800, -73.97615100, -73.97578400, -73.97578400, -73.96793400, -73.97360200, -73.97354900, -73.97354900, -73.97322100, -73.97354900, -73.97354900, -73.96930700, -73.97624800, -73.97048400, -73.97467300, -73.97532900, -73.97299200, -73.97744000, -73.97203100, -73.97203100, -73.97740600, -73.97724200, -73.97493500, -73.97521500, -73.97743000, -73.97713100, -73.96939800, -73.97041300, -73.97004700, -73.97004700, -73.97638700, -73.97695200, -73.97709700, -73.97721900, -73.97744000, -73.97715000, -73.97366100, -73.97332400, -73.97293900, -73.97294600, -73.97314500, -73.97285500, -73.97310600, -73.96892500, -73.96906300, -73.97738600, -73.97209900, -73.97718000, -73.97712708, -73.97712708, -73.97712708, -73.97712708, -73.97712708, -73.97300720, -73.97712708, -73.97674600, ];

txSites = txsite(...
    "Latitude", txLats, ...
    "Longitude", txLons, ...
    "AntennaHeight", txHeight, ...
    "TransmitterPower", 5, ...
    "TransmitterFrequency", 28e9);
show(txSites)

%% define prop model
rtpm = propagationModel("raytracing", ...
    "Method", "image", ...
    "MaxNumReflections", 0, ... % only LOS works
    "BuildingsMaterial","concrete", ...
    "TerrainMaterial","concrete");

%% define rx
lineNbr = 6;
rxRange = [
    % start & end points
    [40.749511, -73.975379, 40.758341, -73.968938];...
    [40.754989, -73.976519, 40.751383, -73.967963];...
    [40.749125, -73.972730, 40.756150, -73.967609];...
    [40.751439, -73.976070, 40.749149, -73.970597];...
    [40.753401, -73.974641, 40.750810, -73.968535];...
    [40.754641, -73.975674, 40.758400, -73.972956]
];

rxSpanDis = [1130, 825, 889, 525, 587, 472]; %distance, m
rxNbr = int16(rxSpanDis) / 10; %number of points
rxLocation = 0 : sum(rxSpanDis(1:lineNbr))/(sum(rxNbr(1:lineNbr)) - 1) : sum(rxSpanDis(1:lineNbr));
rxLats = [];
rxLons = [];
for cnt = 1 : lineNbr
    rxLats = [rxLats, rxRange(cnt, 1) : (rxRange(cnt, 3) - rxRange(cnt, 1)) / (double(rxNbr(cnt))-1): rxRange(cnt, 3)];
    rxLons = [rxLons, rxRange(cnt, 2) : (rxRange(cnt, 4) - rxRange(cnt, 2)) / (double(rxNbr(cnt))-1): rxRange(cnt, 4)];
end


% rxLats = (rxLatR(1) : (rxLatR(2) - rxLatR(1)) / (rxNbr - 1) : rxLatR(2));
% rxLons = (rxLonR(1) : (rxLonR(2) - rxLonR(1)) / (rxNbr - 1) : rxLonR(2));

rxSites = rxsite("Name","User locations", ...
    "Latitude", rxLats, ...
    "Longitude", rxLons, ...
    "AntennaHeight", rxHeight);
show(rxSites);

%% run raytracing
rtpm.MaxNumReflections = 0;
rays = raytrace(txSites, rxSites, rtpm);
connectedRay = cell(1, sum(rxNbr(1:lineNbr)));
connectedSNR = zeros(1, sum(rxNbr(1:lineNbr)));
connectedSINR = zeros(1, sum(rxNbr(1:lineNbr)));

connectedSitesLoc = zeros(sum(rxNbr(1:lineNbr)), 2);

sPower = zeros(1, sum(rxNbr(1:lineNbr)));
iPower = zeros(1, sum(rxNbr(1:lineNbr)));
nPower = GaussianNoisePower(sigma, bandwidth);
iCount = zeros(1, sum(rxNbr(1:lineNbr)));

iPower0 = zeros(1, sum(rxNbr(1:lineNbr)));
iPower15 = zeros(1, sum(rxNbr(1:lineNbr)));
connectedSINR0 = zeros(1, sum(rxNbr(1:lineNbr)));
connectedSINR15 = zeros(1, sum(rxNbr(1:lineNbr)));

%% find nearest BS and calculate SNR
for cnt1 = 1 : sum(rxNbr(1:lineNbr))
    minDis = 9e9;
    
    for cnt2 = 1 : length(txLats)
        tempRay = rays(cnt2, cnt1);
        tempRay = tempRay{1};
        if (length(tempRay) == 1) && (tempRay.PropagationDistance < minDis)
            minDis = tempRay.PropagationDistance;
            connectedRay{cnt1} = tempRay;
        end
    end
    for cnt2 = 1 : length(txLats)
        tempRay = rays(cnt2, cnt1);
        tempRay = tempRay{1};
        if (length(tempRay) == 1) && (tempRay.PropagationDistance ~= minDis) && (tempRay.PropagationDistance < R) && (tempRay.PropagationDistance > r)
            iCount(cnt1) = iCount(cnt1) + 1;
            iPower(cnt1) = iPower(cnt1) + InterferencePower(tempRay.PropagationDistance, Nt, d_to_lambda, alpha, beta, M, Pt);
        end

        if (length(tempRay) == 1) && (tempRay.PropagationDistance ~= minDis) && (tempRay.PropagationDistance < R) && (tempRay.PropagationDistance > 0)
            iPower0(cnt1) = iPower0(cnt1) + InterferencePower(tempRay.PropagationDistance, Nt, d_to_lambda, alpha, beta, M, Pt);
        end
        if (length(tempRay) == 1) && (tempRay.PropagationDistance ~= minDis) && (tempRay.PropagationDistance < R) && (tempRay.PropagationDistance > 15)
            iPower15(cnt1) = iPower15(cnt1) + InterferencePower(tempRay.PropagationDistance, Nt, d_to_lambda, alpha, beta, M, Pt);
        end
    end
    connectedSNR(cnt1) = SNR(minDis, alpha, beta);
    sPower(cnt1) = SignalPower(minDis, Nt, alpha, beta, M, Pt);
    connectedSINR(cnt1) = 10 * log10(sPower(cnt1)/(nPower + iPower(cnt1))) + TxRxGain;
    
    connectedSINR0(cnt1) = 10 * log10(sPower(cnt1)/(nPower + iPower0(cnt1))) + TxRxGain;
    connectedSINR15(cnt1) = 10 * log10(sPower(cnt1)/(nPower + iPower15(cnt1))) + TxRxGain;
end

% for cnt1 = 1 : sum(rxNbr(1:lineNbr))
%     connectedSitesLoc(cnt1, 1) = connectedRay{cnt1}.TransmitterLocation(1);
%     connectedSitesLoc(cnt1, 2) = connectedRay{cnt1}.TransmitterLocation(2);
%     %plot(connectedRay{cnt1})
% end

connectedSitesCnt = length(unique(connectedSitesLoc, 'row'));

%% plot SNR curve
figure(1)
hold on
plot(rxLocation, connectedSNR, 'LineWidth', 2);
plot(rxLocation, connectedSINR, '-.', 'LineWidth', 1.5);
plot(rxLocation, connectedSINR15, '--', 'LineWidth', 1.5);
plot(rxLocation, connectedSINR0, '--', 'LineWidth', 1.5);
for cnt = 1:lineNbr
    xline(sum(rxSpanDis(1:cnt)))
end
hold off
ylabel('SNR');
xlabel('Distance/m');
legend('No Interference', 'With Interference, r=30', 'With Interference, r=15', 'With Interference, r=0');
% legend('Measured model', "Theoretical model");

[f_SNR, x_SNR] = ecdf(connectedSNR);
[f_SINR, x_SINR] = ecdf(connectedSINR);
[f_SINR0, x_SINR0] = ecdf(connectedSINR0);
[f_SINR15, x_SINR15] = ecdf(connectedSINR15);

figure(2)
hold on
plot(x_SNR, f_SNR, 'LineWidth', 2)
plot(x_SINR, f_SINR, 'LineWidth', 2)
plot(x_SINR15, f_SINR15, 'LineWidth', 2)
plot(x_SINR0, f_SINR0, 'LineWidth', 2)
legend('No Interference', 'With Interference, r=30', 'With Interference, r=15', 'With Interference, r=0');
hold off

%% path model
% path gain value
function pg = PG(d, alpha, beta)
    % Int-LOS result
    n = alpha;
    b = 10 * log10(beta); %dB
    %theta = 4.5; %dB
    pg = 10*n*log10(d)+b;
end

% SNR
function snr = SNR(d, alpha, beta)
    Ptx = 28; % tx power
    Gtx = 23; % tx gain
    PGmed = PG(d, alpha, beta); % path gain
    Grx = 11; % rx gain
    Pnf = -174 + 10*log10(800e6)+10; % 800 MHz bandwidth
    snr = Ptx + Gtx + PGmed + Grx - Pnf;
end

function ip = InterferencePower(d, Nt, d_to_lambda, alpha, beta, M, Pt)
    [m, v] = gamstat(M, 1/M); % mean value of rho^2
    persistent x0; 
    persistent It0;
    if isempty(x0)
        x0 = pi * Nt * d_to_lambda;
        It0 = (2 * sinint(2 * x0) + cos(2 * x0) - 1) / (x0 * x0); % average value of sin^2(x)/x^2
    elseif x0 ~= pi * Nt * d_to_lambda
        x0 = pi * Nt * d_to_lambda;
        It0 = (2 * sinint(2 * x0) + cos(2 * x0) - 1) / (x0 * x0);
    end
    ip = beta * Nt * Pt * It0 * (d^alpha) * m;
end

function np = GaussianNoisePower(sigma, bandwidth)
    np = 10^(-17.4 + log10(bandwidth) + sigma / 10);
end

function sp = SignalPower(d, Nt, alpha, beta, M, Pt)
    [m, v] = gamstat(M, 1/M); % mean value of rho^2
    sp = beta * Nt * Pt * (d^alpha) * m;
end